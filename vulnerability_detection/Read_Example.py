import sys
sys.path.insert(1, '../src/')
import ReadFile
import World
import Utility
import Statistics
import os
import os.path as osp



def get_model(example_path):
    UserModel = Utility.module_from_file("Generate_model", osp.join(example_path, 'UserModel.py'))
    model = UserModel.UserModel()
    return model

def get_policy(example_path):
    Generate_policy = Utility.module_from_file("Generate_policy", osp.join(example_path, 'Generate_policy.py'))
    policy_list, event_restriction_fn = Generate_policy.generate_policy()
    return policy_list, event_restriction_fn

def get_config_path(path):
    config_filepath = osp.join(path, 'config.txt')
    return config_filepath

class Read_Example():

    def __init__(self, example_path):
        args = Utility.parse_args()

        example_path = args.example_path
        self.config_filename = get_config_path(example_path)

        # Read Config file using ReadFile.ReadConfiguration
        self.config_obj=ReadFile.ReadConfiguration(self.config_filename)

        self.agents_filename, self.interactions_FilesList_filename,\
            self.events_FilesList_filename, self.locations_filename, self.one_time_event_file, self.probabilistic_interactions_FilesList_filename = self.config_obj.get_file_paths(example_path)
        self.interactions_files_list, self.events_files_list, self.probabilistic_interactions_files_list = self.config_obj.get_file_names_list(
            example_path, self.interactions_FilesList_filename, self.events_FilesList_filename, self.probabilistic_interactions_FilesList_filename)

        # User Model and Policy
        self.model = get_model(example_path)
        self.policy_list, self.event_restriction_fn=get_policy(example_path)

        # make a results directory
        if not osp.isdir(osp.join(self.config_obj.example_path,'results')):
            os.mkdir(osp.join(self.config_obj.example_path,'results'))

        # Creation of World object
        self.world_obj = World.World(self.config_obj, self.model, self.policy_list, self.event_restriction_fn, self.agents_filename, self.interactions_files_list, self.probabilistic_interactions_files_list, self.locations_filename, self.events_files_list, self.one_time_event_file)
