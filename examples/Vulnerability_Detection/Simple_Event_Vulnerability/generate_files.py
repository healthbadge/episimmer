import sys
from csv import DictWriter
from random import randint, sample


def write_agents(filename, no_agents):
    header = 'Agent Index'

    with open(filename, 'w') as f:
        f.write(f'{no_agents}\n')
        f.write(f'{header}\n')

        for i in range(no_agents):
            f.write(f'{i}\n')


def write_locations(filename, no_locations):
    header = 'Location Index'

    with open(filename, 'w') as f:
        f.write(f'{no_locations}\n')
        f.write(f'{header}\n')

        for i in range(no_locations):
            f.write(f'{i}\n')


def write_interactions(filename, no_agents, no_interactions):
    with open(filename, 'w', newline='') as file:
        fieldnames = ['Agent Index', 'Interacting Agent Index']
        writer = DictWriter(file, fieldnames=fieldnames)

        writer.writeheader()
        for i in range(no_interactions):
            agent = randint(0, no_agents - 1)
            contact_agent = randint(0, no_agents - 1)
            if agent != contact_agent:
                writer.writerow({'Agent Index': agent, 'Interacting Agent Index': contact_agent})
                writer.writerow({'Agent Index': contact_agent, 'Interacting Agent Index': agent})


def write_events(files, no_locations, no_agents):
    header = 'Id:Location Index:Agents'

    event_id = 0
    for file in files:
        with open(file, 'w') as f:
            n = randint(1, 3)
            f.write(f'{n}\n')
            f.write(f'{header}\n')

            for _ in range(n):
                line = f'{event_id}:'
                event_id += 1
                line += f'{randint(0, no_locations - 1)}:'
                line += ','.join(str(agent) for agent in sample(range(no_agents), randint(1, 20)))
                f.write(line + '\n')


def main():
    no_agents, no_locations = int(sys.argv[1]), int(sys.argv[2])
    event_files = ['one_event.txt', 'two_event.txt', 'three_event.txt', 'four_event.txt', 'five_event.txt',
                   'six_event.txt']

    write_agents('agents.txt', no_agents)
    write_locations('locations.txt', no_locations)
    write_interactions('interactions.csv', no_agents, 100)
    write_events(event_files, no_locations, no_agents)


if __name__ == '__main__':
    main()
